/*
 * Example User and Notification Configuration for Twilio
 * Add this to your Icinga2 configuration (e.g., /etc/icinga2/conf.d/users.conf)
 */

// Define a user with Twilio credentials and phone number
object User "admin" {
  import "generic-user"

  display_name = "Admin User"
  email = "admin@example.com"
  
  // Phone number in E.164 format (e.g., +15551234567)
  pager = "+15551234567"
  
  // Twilio API credentials (alternatively, set these as system environment variables)
  vars.twilio_api_key = "SKxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
  vars.twilio_api_secret = "your_api_secret_here"
  vars.twilio_account_sid = "ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
  vars.twilio_from_number = "+15559876543"
  
  // Enable host and service notifications
  enable_notifications = true
  states = [ OK, Warning, Critical, Unknown, Up, Down ]
  types = [ Problem, Acknowledgement, Recovery, Custom, FlappingStart, FlappingEnd, DowntimeStart, DowntimeEnd, DowntimeRemoved ]
}

// Host notification for Twilio
apply Notification "twilio-host" to Host {
  import "generic-notification"

  command = "twilio-host-notification"
  users = [ "admin" ]

  // Notification intervals and filters
  interval = 30m
  
  states = [ Down, Up ]
  types = [ Problem, Recovery ]
  
  // Only send notifications during specific time periods if needed
  // period = "24x7"
  
  assign where host.vars.notification_twilio == true
}

// Service notification for Twilio
apply Notification "twilio-service" to Service {
  import "generic-notification"

  command = "twilio-service-notification"
  users = [ "admin" ]

  // Notification intervals and filters
  interval = 30m
  
  states = [ OK, Warning, Critical, Unknown ]
  types = [ Problem, Recovery ]
  
  // Only send notifications during specific time periods if needed
  // period = "24x7"
  
  assign where service.vars.notification_twilio == true
}
